name: Dependabot on Another Branch

on:
  workflow_dispatch:
    inputs:
      target-branch:
        description: "Branch to run Dependabot against"
        required: true
        default: "develop"

jobs:
  run-dependabot:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout target branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.target-branch }}

      - name: Set up Ruby (Dependabot scripts are Ruby)
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.2"

      - name: Install dependabot-script
        run: |
          git clone https://github.com/dependabot/dependabot-script.git
          cd dependabot-script
          bundle install

      - name: Run Dependabot (npm example)
        run: |
          cd dependabot-script
          bundle exec ruby ./generic-update-script.rb \
            -d=".github" \
            -p="npm"
        env:
          GITHUB_ACCESS_TOKEN: ${{ secrets.GHCR_TOKEN }}
